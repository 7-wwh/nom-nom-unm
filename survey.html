document.addEventListener("DOMContentLoaded", function() {
  // --- DOM Elements ---
  const surveyForm = document.getElementById('surveyForm');
  const submitButton = document.getElementById('submitSurvey');
  const progressFill = document.getElementById('surveyProgress');
  const currentQuestionSpan = document.getElementById('currentQuestion');
  const completionPercentSpan = document.getElementById('completionPercent');
  const resultsPreview = document.getElementById('resultsPreview');
  const selectedPreferences = document.getElementById('selectedPreferences');
  const loadingOverlay = document.getElementById('loading-overlay');
  const loadingMessage = document.getElementById('loadingMessage');
  const mealTypeHeader = document.getElementById('mealTypeHeader');
  const mealTypeText = document.querySelectorAll('.mealTypeText');
  
  // --- Survey Data ---
  const survey = {
    totalQuestions: 4,
    answeredQuestions: 0,
    responses: {
      spice: null,
      cuisine: null,
      taste: null,
      diet: null
    },
    icons: {
      spice: {
        'Not Spicy': 'fa-snowflake',
        'Mild': 'fa-temperature-low',
        'Medium': 'fa-temperature-half',
        'Hot': 'fa-fire',
        'Extra Hot': 'fa-fire-flame-curved'
      },
      cuisine: {
        'Local': 'fa-location-dot',
        'Italian': 'fa-pizza-slice',
        'Chinese': 'fa-bowl-food',
        'Mexican': 'fa-pepper-hot',
        'Indian': 'fa-mortar-pestle',
        'Fusion': 'fa-utensils'
      },
      taste: {
        'Sweet': 'fa-ice-cream',
        'Savory': 'fa-drumstick-bite',
        'Both': 'fa-yin-yang'
      },
      diet: {
        'None': 'fa-circle-check',
        'Vegetarian': 'fa-seedling',
        'Vegan': 'fa-leaf',
        'Gluten-Free': 'fa-wheat-awn-circle-exclamation'
      }
    }
  };

  // --- Loading Messages ---
  const loadingMessages = [
    "Analyzing your flavor preferences...",
    "Searching for culinary matches...",
    "Consulting with virtual chefs...",
    "Cooking up recommendations...",
    "Adding a pinch of magic...",
    "Almost ready to serve!"
  ];

  // --- Functions ---

  // Set time-of-day appropriate meal greeting
  function setTimeBasedGreeting() {
    const hour = new Date().getHours();
    let mealType;
    
    if (hour >= 5 && hour < 11) {
      mealType = "Breakfast";
    } else if (hour >= 11 && hour < 15) {
      mealType = "Lunch";
    } else if (hour >= 15 && hour < 18) {
      mealType = "Snack";
    } else if (hour >= 18 && hour < 23) {
      mealType = "Dinner";
    } else {
      mealType = "Late-Night Meal";
    }
    
    mealTypeHeader.textContent = mealType;
    mealTypeText.forEach(element => {
      element.textContent = mealType.toLowerCase();
    });
  }

  // Update progress bar and text
  function updateProgress() {
    const progress = (survey.answeredQuestions / survey.totalQuestions) * 100;
    progressFill.style.width = `${progress}%`;
    currentQuestionSpan.textContent = Math.min(survey.answeredQuestions + 1, survey.totalQuestions);
    completionPercentSpan.textContent = Math.round(progress);
    
    // Enable/disable submit button based on completion
    submitButton.disabled = survey.answeredQuestions < survey.totalQuestions;
  }

  // Update results preview
  function updateResultsPreview() {
    // Clear existing content
    selectedPreferences.innerHTML = "";
    
    // Create badges for each selected option
    for (const [category, value] of Object.entries(survey.responses)) {
      if (value) {
        const icon = survey.icons[category][value];
        const badge = document.createElement('div');
        badge.className = 'result-badge';
        badge.innerHTML = `<i class="fa-solid ${icon}"></i> ${value}`;
        selectedPreferences.appendChild(badge);
      }
    }
    
    // Show preview only when at least one option is selected
    if (survey.answeredQuestions > 0) {
      resultsPreview.style.display = 'block';
    } else {
      resultsPreview.style.display = 'none';
    }
  }

  // Setup option button handling for a category
  function setupOptionButtons(categoryId, categoryName) {
    const buttons = document.querySelectorAll(`#${categoryId} .option-button`);
    
    buttons.forEach(button => {
      button.addEventListener('click', function() {
        // Remove selected class from all buttons in category
        buttons.forEach(btn => btn.classList.remove('selected'));
        
        // Add selected class to clicked button
        this.classList.add('selected');
        
        // Store response
        const value = this.getAttribute(`data-${categoryName}`);
        
        // If this is a new selection (not changing an existing one)
        if (!survey.responses[categoryName]) {
          survey.answeredQuestions++;
        }
        
        // Update the response
        survey.responses[categoryName] = value;
        
        // Update progress and preview
        updateProgress();
        updateResultsPreview();
        
        // Animate the button with a slight bounce
        this.classList.add('animate__animated', 'animate__pulse');
        setTimeout(() => {
          this.classList.remove('animate__animated', 'animate__pulse');
        }, 500);
      });
    });
  }

  // Handle survey submission with animation
  function handleSubmit(e) {
    e.preventDefault();
    
    // Show loading overlay
    loadingOverlay.style.display = 'flex';
    
    // Animate through loading messages
    let messageIndex = 0;
    
    function showNextMessage() {
      if (messageIndex < loadingMessages.length) {
        // Add animation classes
        loadingMessage.classList.remove('animate__fadeIn');
        loadingMessage.classList.add('animate__fadeOut');
        
        // After fadeout completes, change text and fade in
        setTimeout(() => {
          loadingMessage.textContent = loadingMessages[messageIndex];
          loadingMessage.classList.remove('animate__fadeOut');
          loadingMessage.classList.add('animate__fadeIn');
          messageIndex++;
          
          // Schedule next message
          setTimeout(showNextMessage, 1800);
        }, 500);
      } else {
        // All messages shown, redirect to results
        setTimeout(() => {
          // In a real app, we'd actually submit the form or use AJAX here
          // For demo purposes, we'll construct a URL with query params
          const params = new URLSearchParams();
          for (const [key, value] of Object.entries(survey.responses)) {
            params.append(key, value);
          }
          
          // Redirect to results page (or simulate it)
          window.location.href = `results.html?${params.toString()}`;
        }, 1000);
      }
    }
    
    // Start message animation
    loadingMessage.classList.add('animate__animated', 'animate__fadeIn');
    loadingMessage.textContent = loadingMessages[messageIndex];
    messageIndex++;
    setTimeout(showNextMessage, 1800);
  }

  // Animate footer on scroll
  function animateFooterOnScroll() {
    const footer = document.querySelector('.footer-animate');
    const footerPosition = footer.getBoundingClientRect().top;
    const screenPosition = window.innerHeight;
    
    if (footerPosition < screenPosition) {
      footer.classList.add('visible');
    }
  }

  // --- Initialize ---
  function init() {
    // Setup time-based greeting
    setTimeBasedGreeting();
    
    // Setup option buttons for each category
    setupOptionButtons('spiceOptions', 'spice');
    setupOptionButtons('cuisineOptions', 'cuisine');
    setupOptionButtons('tasteOptions', 'taste');
    setupOptionButtons('dietOptions', 'diet');
    
    // Add form submit event listener
    surveyForm.addEventListener('submit', handleSubmit);
    
    // Add scroll event listener for footer animation
    window.addEventListener('scroll', animateFooterOnScroll);
    
    // Initial progress update
    updateProgress();
  }
  
  // Initialize everything
  init();
});
  </script>
</body>
</html>